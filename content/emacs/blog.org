#+title: å…³äºè¿™æ•´ä¸ª EServer çš„ Emacs

* EServer - æœåŠ¡å™¨ä¸»ä½“
* Blog - åšå®¢
** [[https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs][Data URLs]]
   ä¸€å¼€å§‹å¼„ =blog/server.el= çš„æ—¶å€™åªè®©è®¿é—®ç›®å½•ä¸‹çš„ =.org= æ–‡ä»¶ï¼Œç»“æœ
   è¿å›¾ç‰‡éƒ½çœ‹ä¸åˆ°ï¼Œå°±æƒ³åˆ°äº†è¿™ä¸ªé¦Šä¸»æ„ğŸ˜‰ã€‚ä¸è¿‡æœ€åè¿˜æ˜¯è®©è®¿é—®å›¾ç‰‡å’Œæ–‡ä»¶
   å•¥çš„äº†ï¼Œäºæ˜¯å°±æŠŠ =dataurl= çš„é€‰é¡¹æ”¾åˆ° URL parameter é‡Œï¼Œå¦‚æœ
   =dataurl=t= çš„è¯ï¼Œå°±æŠŠ =.org= é‡Œçš„æœ¬åœ°å›¾ç‰‡éƒ½å˜æˆ Data URLï¼Œé…±æ•´ä¸ª
   HTML å°±å˜æˆ stand-alone çš„å•¦ã€‚

   =html-image-dataurl-src= åœ¨ =blog/server.el= é‡Œæ˜¯è¿™ä¹ˆå†™çš„ï¼Œè¿˜ç”¨äº†ä¸ª
   =base64-image-encode-cons= ã€‚ï¼ˆä¸ºäº†èƒ½ä»æ–‡ä»¶é‡Œè¾“å‡ºè¿™ä¿©å‡½æ•°æˆ‘è¿˜åˆå†™äº†
   ä¿©å‡½æ•° =extract-function-from-file= å’Œ
   =extract-function-from-file-to-org= ğŸ˜‚ï¼Œä¸è¿‡ç°åœ¨å¯ä»¥éšä¾¿æå–å‡½æ•°å•¦ï¼Œ
   å“¦è€¶ğŸ˜ƒï¼‰

   #+BEGIN_SRC elisp :exports results :results drawer
     (extract-function-from-file-to-org (expand-file-name "server.el"
                                                          eserver-blog)
                                        '(base64-image-encode-cons
                                          html-image-dataurl-src))
   #+END_SRC

   å½“ç„¶ä¹Ÿå¯ä»¥æ•…æ„åœ¨ =.org= é‡ŒåµŒå…¥ base64 ç¼–ç çš„å›¾ç‰‡ï¼Œè¿™é‡Œå°±æ‹¿ç½‘ç«™çš„
   favicon åšä¸ªä¾‹å­å­ï¼š

   å¯ä»¥è‡ªå·±å†™ï¼š
   #+BEGIN_SRC org
     ,#+BEGIN_SRC elisp :exports results :results html
       (with-temp-buffer
         (insert-file-contents-literally (expand-file-name "favicon.ico"
                                                           eserver-root))
         (base64-encode-region (point-min) (point-max) t)
         (format "<img src=\"data:image/jpg;base64,%s\">"
                 (buffer-string)))
     ,#+END_SRC
  #+END_SRC


  ä¹Ÿå¯ä»¥ç”¨è‡ªå·±å†™çš„å‡½æ•°å†™ğŸ˜‰ï¼š
  #+BEGIN_SRC org
    ,#+BEGIN_SRC elisp :exports results :results html
      (format "<img src=\"%s\">"
              (html-image-dataurl-src (expand-file-name "favicon.ico"
                                                        eserver-root)))
    ,#+END_SRC
  #+END_SRC

  ç»“æœéƒ½æ˜¯é…±çš„ï¼š
  #+BEGIN_SRC elisp :exports results :results html
    (format "<img src=\"%s\">"
            (html-image-dataurl-src (expand-file-name "favicon.ico"
                                                      eserver-root)))
  #+END_SRC

** æå– =.el= ä¸­å‡½æ•°å®šä¹‰

   è¿™å°±æ˜¯åˆšåˆšä¸ºäº† /æ˜¾ç¤ºä¸¤ä¸ªç”Ÿæˆ Data URL çš„å‡½æ•°/ è€Œå†™çš„å‡½æ•°å•¦ï¼ŒåŸºæœ¬å°±
   æ˜¯æ— è„‘ç”¨ä¸ª temp buffer æ‰“å¼€æ–‡ä»¶ï¼Œç„¶åå†æœç´¢ä¸€ä¸‹ï¼Œæœ€åç”¨ä¸ª
   =scan-sexps= åŒ¹é…ä¸€ä¸‹è¡¨è¾¾å¼å°±èƒ½æå–å‡½æ•°å•¦ï¼š
   #+BEGIN_SRC elisp :exports results :results drawer
     (extract-function-from-file-to-org (expand-file-name "server.el"
                                                          eserver-blog)
                                        '(extract-function-from-file
                                          extract-function-from-file-to-org))
   #+END_SRC

   ä¸è¿‡çªç„¶å‘ç°å¦‚æœå¼•ç”¨åŒä¸€ä¸ªæ–‡ä»¶å†…çš„å‡½æ•°å¤šæ¬¡çš„è¯ï¼Œä¼šå¼€å¥½å‡ ä¸ª bufferï¼Œ
   æ„Ÿè§‰ä¸å¤ªé«˜æ•ˆçš„æ ·å­ï¼Œå‘œå‘œã€‚

* Weibo - å¾®åšçƒ­æœå†å²
