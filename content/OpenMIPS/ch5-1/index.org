#+title: Ch5 ä¸Š --- Data Hazard çš„è§£å†³

é‡‡ç”¨æ•°æ®å‰æ¨(forwarding)è§£å†³ data hazard:

#+caption: åŠ äº†æ•°æ®å‰æ¨çš„æµæ°´çº¿
{{{image(100)}}}
[[./pipeline.jpg]]

#+caption: æ¨¡å—æ¥å£åŠå…³ç³»
{{{image(100)}}}
[[./modules.jpg]]

ç›¸å¯¹äºç¬¬å››ç« , EX å’Œ MEM é˜¶æ®µéƒ½æœ‰æ•°æ®çº¿å°† =wdata=, =wd=, =wreg= å†™å› ID
çš„ä¸¤ä¸ªæ“ä½œæ•°ä¸­.  ä¹Ÿå°±æ˜¯è¯´ =id= è¦æ·»åŠ å…­ä¸ªè¾“å…¥: =ex_wreg_i=, =ex_wd_i=,
=ex_wdata_i=, =mem_wreg_i=, =mem_wd_i=, =mem_wdata_i=.  å½“ç„¶, è°ƒç”¨
=id= çš„ =openmips= ä¹Ÿè¦æ”¹ä¸€ä¸‹.
#+include: "id.v" src verilog
#+include: "openmips.v" src verilog

ç”¨è¿™æ ·ä¸€ä¸ªç¨‹åºæµ‹è¯•ä¸€ä¸‹ Data Hazard çš„è§£å†³, å…¶ä¸­æ¯æ¡æŒ‡ä»¤éƒ½ä¾èµ–ä¹‹å‰ç”šè‡³
å†ä¹‹å‰çš„ =$1=:
#+include: "inst_rom.s" src mips

å¦‚æœæ˜¯ç¬¬å››ç« çš„æœ€ç®€å®ç°, å°±ä¼šäº§ç”Ÿå„ç§é—®é¢˜:
{{{image(100)}}}
[[./waveform-with-hazard.png]]

ç¬¬ä¸€ä¸ªæŒ‡ä»¤ I1 çš„ç»“æœæ˜¯æ­£å¸¸çš„, ä½†ç¬¬äºŒä¸ªæŒ‡ä»¤ I2 åœ¨IDç»™EXçš„æ“ä½œæ•°æ˜¯ =$1=,
è€Œæ­¤æ—¶ =$1= è¿˜æ²¡è¢«å†™å›, å°±å‡ºé—®é¢˜äº†.  I3 ä¸ I1 é—´éš”ä¸€ä¸ªæŒ‡ä»¤ä¹Ÿä¼šå‡ºé—®é¢˜.
åªæœ‰åˆ°æœ€åçš„ I4, ç”±äºåœ¨ =regfile= ä¸­å·²ç»å¤„ç†äº†é—´éš”ä¸¤ä¸ªæŒ‡ä»¤çš„ Data
Hazard, æ‰€ä»¥ I4 çš„ç»“æœä¸­åªæœ‰ I1 å’Œ I4 è‡ªå·±, è€Œæ²¡æœ‰ I2 å’Œ I3.

ç„¶åæ˜¯ä¿®æ”¹çš„, å¯ä»¥çœ‹åˆ°è«å¾—é—®é¢˜ğŸ˜:
{{{image(100)}}}
[[./waveform-hazard-resolved.png]]
