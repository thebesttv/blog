#+title: Dissection Font

èµ·å› æ˜¯çœ‹åˆ°é˜®ä¸€å³°çš„å‘¨æŠ¥é‡Œé¢æœ‰è¿™ä¸ª [[http://erikdemaine.org/fonts/dissect/?text=thebesttv&both=1&4piece=1][Dissection Font]], æ„Ÿè§‰è¿˜æŒºå¥½ç©çš„, å°±æŠŠ
ç½‘é¡µä¸Šçš„ç»“æœç»™å¼„ä¸‹æ¥æ”¾åˆ° Longan ä¸Šæ˜¾ç¤ºäº†.  å…¶å®æˆ‘ä¹Ÿä¸å¤ªæ¸…æ¥šè¿™æ˜¯å•¥, åª
æ˜¯æŠŠå®ƒå½“æˆå­—ä½“äº†ğŸ˜‚

æ‰’ä¸€æ®µç½‘é¡µä¸Šçš„ä»‹ç»:
#+begin_quote
In these fonts, each letter or digit or ampersand (=&=) can be
*dissected* (cut into pieces such that those pieces re-arrange) into a
6\times6 square.  The dissections all happen to be polyomino
dissections, and they allow _translation, rotation, and reflection in
the piece re-arrangement_.  There are four different fonts, each using
up to 2, 3, or 4 pieces in each dissection.  Of course, with more
pieces, it is easier to get nicer-looking letters.  The 2- and 4-piece
*disconnected* fonts use some disconnected pieces (but still *each
piece moves as a single unit*), while the 2- and 3-piece *connected*
fonts use connected pieces.  In the disconnected fonts, we achieve
_uniform letter heights_.
#+end_quote

Dissection Font ä¸»è¦æœ‰å››ç§, æ¯ç§åŒ…æ‹¬åŸå§‹çš„å­—æ¯å’Œå­—æ¯æ‹†åˆ†é‡ç»„æˆçš„æ­£æ–¹å½¢:
- 4-piece disconnected font
  {{{image(40)}}}
  [[./dissection-font/4-disconnected.png]]
- 2-piece disconnected font
  {{{image(40)}}}
  [[./dissection-font/2-disconnected.png]]
- 3-piece connected font
  {{{image(40)}}}
  [[./dissection-font/3-connected.png]]
- 2-piece connected font
  {{{image(40)}}}
  [[./dissection-font/2-connected.png]]

å¤§æ¦‚å•¥æ„æ€å·²ç»æ¸…æ¥šäº†, ç°åœ¨å°±æƒ³åŠæ³•å¼„åˆ° Longan ä¸Š.

å››ç§å­—ä½“ä¸­çš„æ¯ä¸ªå­—ç¬¦éƒ½ä¿å­˜åœ¨ =Font= é‡Œ, åŒ…æ‹¬åŸå§‹å­—æ¯å’Œé‡ç»„åçš„æ­£æ–¹å‹.
æ¯ä¸ªå­—ç¬¦æœ‰ä»¥åƒç´ ä¸ºå•ä½çš„å®½é«˜, å’Œåƒç´ çš„ä¿¡æ¯.  å› ä¸ºéƒ½èƒ½é‡ç»„æˆ 6\times6
çš„æ­£æ–¹å½¢, å­—ç¬¦éƒ½æ˜¯ç”±36ä¸ªåƒç´ ç»„æˆçš„, æ¯ä¸ªåƒç´ åŒ…æ‹¬å—å·(ä¸Šæ–‡å›¾ç‰‡ä¸­ä¸åŒé¢œ
è‰²ä»£è¡¨ä¸åŒå—)å’Œåº§æ ‡.
#+begin_src c
  struct Font {
      uint8_t width;
      uint8_t height;
      uint8_t pixels[36][3];
  };
#+end_src

ç½‘é¡µæºç é‡Œæœ‰å‡ ä¸ªä¸»è¦çš„ =js= æ–‡ä»¶:
#+begin_src html
  <SCRIPT TYPE="text/javascript" src="Knuth.js"></SCRIPT>
  <SCRIPT TYPE="text/javascript" src="2piece.js"></SCRIPT>
  <SCRIPT TYPE="text/javascript" src="2piece-discon.js"></SCRIPT>
  <SCRIPT TYPE="text/javascript" src="index.js"></SCRIPT>
#+end_src
è¿™å››ä¸ªæ–‡ä»¶æœ€åçš„ç»“æœåŸºæœ¬å°±æ˜¯ä¸€ä¸ª =fonts=, é‡Œé¢æœ‰å››ç§å­—ä½“çš„æ•°æ®. æŠŠå®ƒä»¬
éƒ½ä¸‹ä¸‹æ¥, æ–°å»ºä¸€ä¸ª =process.js= æŠŠå­—ä½“è¾“å‡ºæˆ C çš„8ä¸ª =Font= æ•°ç»„:
#+begin_src js
  var nameMp = {
      '4piece_solved': 'n4_disconnected_letter',
      '4piece_square': 'n4_disconnected_square',

      '2piece-discon_solved': 'n2_disconnected_letter',
      '2piece-discon_square': 'n2_disconnected_square',

      '3piece_solved': 'n3_connected_letter',
      '3piece_square': 'n3_connected_square',

      '2piece_solved': 'n2_connected_letter',
      '2piece_square': 'n2_connected_square',
  };

  function printNode(node, str) {
      console.log("  // " + str);
      console.log("  {" + node["width"] + ", " + node["height"] + ", {");
      for (var j = 0; j < 36; j += 3) {
          process.stdout.write("    ");
          process.stdout.write("{" + node["pixels"][j] + "}, ");
          process.stdout.write("{" + node["pixels"][j+1] + "}, ");
          process.stdout.write("{" + node["pixels"][j+2] + "},");
          process.stdout.write("\n");
      }
      process.stdout.write("  }},\n");
  }

  for (const key in fonts) {
      console.log("const struct Font " + nameMp[key] + "[] = {");
      for (var i = 0; i < 10; ++i) {
          var node = fonts[key][i];
          printNode(node, i);
      }
      for (var i = 0; i < 26; ++i) {
          var x = String.fromCharCode(i + 65);
          var node = fonts[key][x];
          printNode(node, x);
      }
      if (key == '2piece_solved' || key == '2piece_square') {
          // do nothing
      } else {
          printNode(fonts[key]['&'], '&');
      }
      console.log("};");
  }
#+end_src

æœ€åå°±æ˜¯æŠŠè¿™5ä¸ªæ–‡ä»¶åˆå¹¶, å†ç”¨ =node= è·‘ä¸€ä¸‹:
#+begin_src bash
  $ cat Knuth.js 2piece.js 2piece-discon.js index.js process.js > main.js
  $ node main.js > font_data.h
#+end_src
é…±å°±å¾—åˆ°å­—ä½“æ•°æ®å•¦.

é¡¹ç›®çš„è¯, ä¸»è¦æ˜¯ä¸‰ä¸ªæ–‡ä»¶:
- =font_data.h=: åŒ…å«äº†å…«ä¸ª =Font= æ•°ç»„, æ¯ä¸ªæ•°ç»„é•¿åº¦ä¸º36æˆ–37.  æ¯ç±»å­—
  ä½“éƒ½èƒ½æ˜¾ç¤ºæ•°å­—å’Œå¤§å†™å­—æ¯, é™¤ 2-piece connected font å¤–éƒ½èƒ½æ˜¾ç¤º
  ampersand (=&=).  æ•°ç»„ä¸­å…ˆå­˜æ•°å­—, å†å­—æ¯, æœ€åæœ‰çš„è¯å†å­˜ ampersand.
- =font.h=: å®šä¹‰äº† =Font= å’Œå„ç§è¾“å‡ºå’Œæ˜¾ç¤ºå­—ä½“çš„å‡½æ•°.  è¢« =main.c= å‰
  è¦å…ˆé€‰æ‹©å­—ä½“.  é  =main.c= çš„é€‰æ‹©ç¡®å®š =fonts_letter=, =fonts_square=
  å’Œ =FONT_SIZE= çš„å€¼, ç”¨æ¥åœ¨ =main.c= ä¸­è¾“å‡ºå­—ä½“.
- =main.c=: å…ˆé€‰æ‹©å­—ä½“, å†include =font.h=.  =main= ä¸­ç”¨ä¸²å£è¯»è¾“å…¥, ç„¶
  åæŠŠè¯»åˆ°çš„æ˜¾ç¤ºå‡ºæ¥.  è¾“å…¥å›è½¦(='\r'=)çš„è¯èƒ½æŠŠä¹‹å‰çš„è¾“å…¥å¾ªç¯æ˜¾ç¤º, å†
  æŒ‰ä¸€ä¸‹çš„è¯å°±æ¸…ç©º.
  #+begin_src c
    // choose only one of these
    #define USE_4_DISCONNECTED
    // #define USE_2_DISCONNECTED
    // #define USE_3_CONNECTED
    // #define USE_2_CONNECTED

    #include "font.h"
  #+end_src

è¯´å®è¯ç„¶åå°±æ²¡å•¥äº†.

æœ€åé™„ä¸Š [[https://github.com/thebesttv/Dissection-Font][repo]].
